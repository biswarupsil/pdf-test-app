<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Generator Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
    }

    textarea {
      width: 100%;
      height: 140px;
    }

    button {
      padding: 10px 20px;
      margin-top: 10px;
      font-size: 16px;
    }

    #status {
      margin-top: 12px;
      font-weight: bold;
    }

    /* Debug console */
    #consoleBox {
      margin-top: 20px;
      background: #111;
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      height: 180px;
      overflow-y: auto;
      border-radius: 6px;
    }

    .error {
      color: #ff4d4d;
    }

    .info {
      color: #00d4ff;
    }
  </style>
</head>

<body>

  <h2>PDF Generator Test App</h2>

  <textarea id="textInput">
Hello!
This PDF was generated successfully.
  </textarea>

  <br>

  <button type="button" onclick="generatePDF()">Generate PDF</button>

  <p id="status"></p>

  <!-- Debug console -->
  <div id="consoleBox"></div>

  <script>
    const consoleBox = document.getElementById("consoleBox");

    function log(message, type = "info") {
      const div = document.createElement("div");
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      div.className = type;
      consoleBox.appendChild(div);
      consoleBox.scrollTop = consoleBox.scrollHeight;
    }

    async function wakeUpServer() {
    log("Waking up server...", "info");
    try {
        // We use 'no-cors' mode just to trigger the wake-up without worrying about response
        await fetch("https://pdf-server-gk8k.onrender.com/ping", { mode: 'no-cors' });
        log("Server wake-up signal sent.");
    } catch (e) {
        console.log("Wake-up ping sent (error ignored)");
    }
}

// Call this immediately when the script loads
wakeUpServer();
    
    async function generatePDF() {
      const status = document.getElementById("status");
      status.textContent = "Generating PDFâ€¦ please wait";

      log("Generate button clicked");
      log("Preparing HTML for PDF");

      const text = document.getElementById("textInput").value;

      const html = `
        <html>
          <head>
            <style>
              body { font-family: Arial; padding: 40px; }
            </style>
          </head>
          <body>
            <h1>Generated PDF</h1>
            <p>${text.replace(/\n/g, "<br>")}</p>
          </body>
        </html>
      `;

      try {
        log("Sending POST request to PDF server");

        const response = await fetch(
          "https://pdf-server-gk8k.onrender.com/pdf",
          {
            method: "POST",
            headers: {
              "Content-Type": "text/html"
            },
            body: html
          }
        );

        log("Response received: HTTP " + response.status);

        if (!response.ok) {
          throw new Error("Server returned status " + response.status);
        }

        const blob = await response.blob();
        log("PDF blob received (" + blob.size + " bytes)");

        const url = URL.createObjectURL(blob);

        status.innerHTML =
          `<a href="${url}" target="_blank">
            Tap here to open / download PDF
          </a>`;

        log("PDF ready. Download link created.");
      } catch (err) {
        status.textContent = "PDF generation failed";
        log("ERROR: " + err.message, "error");
      }
    }

    log("App loaded and ready");
  </script>

</body>
</html>
